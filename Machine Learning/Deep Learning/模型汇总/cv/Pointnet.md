# åŸå§‹è®ºæ–‡
[pointnet++](https://arxiv.org/pdf/1706.02413)
[pointnet](https://arxiv.org/pdf/1612.00593)
# ç‚¹äº‘ä¸‹é‡‡æ ·ï¼ˆæœ€è¿œç‚¹é‡‡æ ·Farthest Point Sampling,FPSï¼‰
***ç›®çš„ï¼šåœ¨å‡å°‘ç‚¹äº‘æ•°é‡çš„åŒæ—¶ï¼Œå°½å¯èƒ½ä¿ç•™ç‰©ä½“çš„å‡ ä½•ç‰¹å¾**
![](assets/Pointnet/pointnet1.png)
éšæœºé€‰å–è¾¹ç¼˜é‡‡æ ·ç‚¹
![](assets/Pointnet/pointnet2.png)
é€‰æ‹©è·ç¦»ç¬¬ä¸€ä¸ªé‡‡æ ·ç‚¹æœ€è¿œçš„ç‚¹ä¸ºç¬¬äºŒä¸ªé‡‡æ ·ç‚¹
![](assets/Pointnet/pointnet3.png)
é€‰å–å„ä¸ªç‚¹ç¦»é‡‡æ ·ç‚¹é›†åˆæœ€è¿‘è·ç¦»æ¯”è¾ƒï¼Œå°†è·ç¦»æœ€å¤§è€…åŠ å…¥é‡‡æ ·ç‚¹
æœ€è¿œç‚¹é‡‡æ ·çš„æ ¸å¿ƒæ€æƒ³å¯ä»¥ç”¨ä»¥ä¸‹å…¬å¼æ€»ç»“ï¼š

**ç¬¬ i ä¸ªé‡‡æ ·ç‚¹çš„é€‰æ‹©å…¬å¼ï¼š**
$p_i = \underset{x \in P}{\text{argmax}} \, \min_{j < i} d(x, p_j)$

**å…¶ä¸­ï¼š**
- $P$ï¼šåŸå§‹ç‚¹é›†
- $p_i$ï¼šç¬¬ i ä¸ªè¢«é‡‡æ ·çš„ç‚¹
- $d(x, y)$ï¼šç‚¹ x ä¸ y ä¹‹é—´çš„è·ç¦»åº¦é‡ï¼ˆå¦‚æ¬§æ°è·ç¦»ï¼‰
- $min_{j < i} d(x, p_j)$ï¼šç‚¹ x åˆ°**å·²é€‰ç‚¹é›†** \(\{p_1, p_2, ..., p_{i-1}\}\) çš„æœ€å°è·ç¦»
- $\underset{x \in P}{\text{argmax}}$ï¼šé€‰æ‹©ä½¿è¯¥æœ€å°è·ç¦»**æœ€å¤§åŒ–**çš„ç‚¹

---

**ç®—æ³•è¿‡ç¨‹ç®€è¿°ï¼š**
1. éšæœºé€‰æ‹©ç¬¬ä¸€ä¸ªç‚¹ $p_1$
2. å¯¹äºæ¯ä¸ªåç»­ç‚¹ $p_i$ï¼Œè®¡ç®—æ‰€æœ‰æœªé€‰ç‚¹åˆ°å·²é€‰ç‚¹é›†çš„æœ€å°è·ç¦»
3. é€‰æ‹©æœ€å°è·ç¦»æœ€å¤§çš„ç‚¹ä½œä¸º $p_i$
4. é‡å¤ç›´åˆ°é€‰å¤Ÿ $k$ ä¸ªç‚¹

---
# æ¨¡å‹æ¡†æ¶
![](assets/Pointnet/pointnet4.png)
## åŸºæœ¬æ€è·¯
1.transformï¼šç¬¬ä¸€æ¬¡ï¼ŒT-Net 3x3ï¼Œå¯¹è¾“å…¥ç‚¹äº‘è¿›è¡Œå¯¹é½ï¼šä½å§¿æ”¹å˜ï¼Œä½¿æ”¹å˜åçš„ä½å§¿æ›´é€‚åˆåˆ†ç±»/åˆ†å‰²ï¼›ç¬¬äºŒæ¬¡ï¼ŒT-Net 64x64ï¼Œå¯¹64ç»´ç‰¹å¾è¿›è¡Œå¯¹é½ã€‚
2.mlpï¼šå¤šå±‚æ„ŸçŸ¥æœºï¼Œç”¨äºæå–ç‚¹äº‘çš„ç‰¹å¾ï¼Œè¿™é‡Œä½¿ç”¨å…±äº«æƒé‡çš„å·ç§¯ã€‚
3.max poolingï¼šæ±‡æ€»æ‰€æœ‰ç‚¹äº‘çš„ä¿¡æ¯ï¼Œè¿›è¡Œæœ€å¤§æ± åŒ–ï¼Œå¾—åˆ°ç‚¹äº‘çš„å…¨å±€ä¿¡æ¯ã€‚
4.åˆ†å‰²éƒ¨åˆ†ï¼šå±€éƒ¨å’Œå…¨å±€ä¿¡æ¯ç»„åˆç»“æ„(concate,è¯­ä¹‰åˆ†å‰²)ã€‚
5.åˆ†ç±»loss:äº¤å‰ç†µï¼šåˆ†å‰²loss:åˆ†ç±»+åˆ†å‰²+L2ï¼ˆtransform,åŸå›¾çš„æ­£äº¤å˜æ¢ï¼‰ã€‚
### T-Net
å°†è¾“å…¥çš„ç‚¹äº‘æ•°æ®ä½œä¸ºnx3x1å•é€šé“å›¾åƒï¼Œæ¥ä¸‰æ¬¡å·ç§¯å’Œä¸€æ¬¡æ± åŒ–åï¼Œå†reshapeä¸º1024ä¸ªèŠ‚ç‚¹ï¼Œç„¶åæ¥ä¸¤å±‚å…¨è¿æ¥ï¼Œç½‘ç»œé™¤æœ€åä¸€å±‚å¤–éƒ½ä½¿ç”¨äº†ReLUæ¿€æ´»å‡½æ•°å’Œæ‰¹æ ‡å‡†åŒ–ã€‚

# ä»£ç 
```python
from __future__ import print_function
import torch
import torch.nn as nn
import torch.nn.parallel
import torch.utils.data
from torch.autograd import Variable
import numpy as np
import torch.nn.functional as F



class STN3d(nn.Module):
    def __init__(self):
        super(STN3d, self).__init__()
        # 1D å·ç§¯å±‚ï¼šå¤„ç†ç‚¹äº‘çš„â€œé€šé“ç»´åº¦â€ï¼ˆæ¯ä¸ªç‚¹çš„ç‰¹å¾ï¼‰ï¼Œkernel_size=1 è¡¨ç¤ºä¸è·¨ç‚¹å·ç§¯
        self.conv1 = nn.Conv1d(3, 64, 1)   # è¾“å…¥3ç»´ï¼ˆx/y/zï¼‰â†’ è¾“å‡º64ç»´
        self.conv2 = nn.Conv1d(64, 128, 1) # 64ç»´ â†’ 128ç»´
        self.conv3 = nn.Conv1d(128, 1024, 1)# 128ç»´ â†’ 1024ç»´
        # å…¨è¿æ¥å±‚ï¼šå°†å…¨å±€ç‰¹å¾æ˜ å°„ä¸º 3Ã—3=9 ç»´ï¼ˆå˜æ¢çŸ©é˜µçš„æ‰å¹³å½¢å¼ï¼‰
        self.fc1 = nn.Linear(1024, 512)
        self.fc2 = nn.Linear(512, 256)
        self.fc3 = nn.Linear(256, 9)
        # æ¿€æ´»å‡½æ•°ä¸æ‰¹å½’ä¸€åŒ–ï¼ˆåŠ é€Ÿè®­ç»ƒï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆï¼‰
        self.relu = nn.ReLU()
        self.bn1 = nn.BatchNorm1d(64)
        self.bn2 = nn.BatchNorm1d(128)
        self.bn3 = nn.BatchNorm1d(1024)
        self.bn4 = nn.BatchNorm1d(512)
        self.bn5 = nn.BatchNorm1d(256)

    def forward(self, x):
        # x è¾“å…¥å½¢çŠ¶ï¼š(batch_size, 3, num_points) â†’ (æ‰¹æ¬¡å¤§å°, ç‰¹å¾ç»´åº¦, ç‚¹çš„æ•°é‡)
        batchsize = x.size()[0]  # è·å–æ‰¹æ¬¡å¤§å°
        
        # 1. å·ç§¯+æ¿€æ´»+æ‰¹å½’ä¸€åŒ–ï¼šæå–å±€éƒ¨ç‰¹å¾
        x = F.relu(self.bn1(self.conv1(x)))  # (B,3,N) â†’ (B,64,N)
        x = F.relu(self.bn2(self.conv2(x)))  # (B,64,N) â†’ (B,128,N)
        x = F.relu(self.bn3(self.conv3(x)))  # (B,128,N) â†’ (B,1024,N)
        
        # 2. å…¨å±€æœ€å¤§æ± åŒ–ï¼šå°† N ä¸ªç‚¹çš„ç‰¹å¾èšåˆä¸º 1 ä¸ªå…¨å±€ç‰¹å¾ï¼ˆä¿è¯æ’åˆ—ä¸å˜æ€§ï¼‰
        x = torch.max(x, 2, keepdim=True)[0]  # (B,1024,N) â†’ (B,1024,1)ï¼ˆdim=2 å¯¹åº”â€œç‚¹çš„æ•°é‡â€ç»´åº¦ï¼‰
        x = x.view(-1, 1024)  # å±•å¹³ä¸º (B, 1024)
        
        # 3. å…¨è¿æ¥å±‚ï¼šæ˜ å°„ä¸º 9 ç»´å‘é‡ï¼ˆ3Ã—3 çŸ©é˜µçš„æ‰å¹³å½¢å¼ï¼‰
        x = F.relu(self.bn4(self.fc1(x)))  # (B,1024) â†’ (B,512)
        x = F.relu(self.bn5(self.fc2(x)))  # (B,512) â†’ (B,256)
        x = self.fc3(x)  # (B,256) â†’ (B,9)
        
        # 4. åˆå§‹åŒ–èº«ä»½çŸ©é˜µï¼ˆå•ä½çŸ©é˜µï¼‰ï¼šè®©æ¨¡å‹åˆå§‹æ—¶â€œä¸å˜æ¢â€ï¼Œç¨³å®šè®­ç»ƒ
        iden = Variable(torch.from_numpy(np.array([1,0,0,0,1,0,0,0,1]).astype(np.float32)))  # (1,9)
        iden = iden.view(1,9).repeat(batchsize,1)  # å¤åˆ¶åˆ°æ‰¹æ¬¡å¤§å°ï¼š(B,9)
        if x.is_cuda:  # å¦‚æœæ¨¡å‹åœ¨GPUä¸Šï¼Œèº«ä»½çŸ©é˜µä¹Ÿç§»åˆ°GPU
            iden = iden.cuda()
        x = x + iden  # å˜æ¢çŸ©é˜µ = å­¦ä¹ çš„åç§» + èº«ä»½çŸ©é˜µ
        
        # 5. é‡å¡‘ä¸º 3Ã—3 çŸ©é˜µ
        x = x.view(-1, 3, 3)  # (B,9) â†’ (B,3,3)
        return x


class STNkd(nn.Module):
    #T-Net2 kç»´å¯¹é½ï¼Œæ€è·¯å’Œä¸‰ç»´ä¸€è‡´
    def __init__(self, k=64):
        super(STNkd, self).__init__()
        self.conv1 = torch.nn.Conv1d(k, 64, 1)
        self.conv2 = torch.nn.Conv1d(64, 128, 1)
        self.conv3 = torch.nn.Conv1d(128, 1024, 1)
        self.fc1 = nn.Linear(1024, 512)
        self.fc2 = nn.Linear(512, 256)
        self.fc3 = nn.Linear(256, k*k)
        self.relu = nn.ReLU()

        self.bn1 = nn.BatchNorm1d(64)
        self.bn2 = nn.BatchNorm1d(128)
        self.bn3 = nn.BatchNorm1d(1024)
        self.bn4 = nn.BatchNorm1d(512)
        self.bn5 = nn.BatchNorm1d(256)

        self.k = k

    def forward(self, x):
        batchsize = x.size()[0]
        x = F.relu(self.bn1(self.conv1(x)))
        x = F.relu(self.bn2(self.conv2(x)))
        x = F.relu(self.bn3(self.conv3(x)))
        x = torch.max(x, 2, keepdim=True)[0]
        x = x.view(-1, 1024)

        x = F.relu(self.bn4(self.fc1(x)))
        x = F.relu(self.bn5(self.fc2(x)))
        x = self.fc3(x)

        iden = Variable(torch.from_numpy(np.eye(self.k).flatten().astype(np.float32))).view(1,self.k*self.k).repeat(batchsize,1)
        if x.is_cuda:
            iden = iden.cuda()
        x = x + iden
        x = x.view(-1, self.k, self.k)
        return x


class PointNetfeat(nn.Module):#ç‰¹å¾æå–å±‚
    def __init__(self, global_feat=True, feature_transform=False):
        super(PointNetfeat, self).__init__()
        self.stn = STN3d()  # åæ ‡å˜æ¢ç½‘ç»œï¼ˆå¿…é€‰ï¼‰
        # å·ç§¯å±‚ï¼šæå–å±€éƒ¨ç‰¹å¾
        self.conv1 = nn.Conv1d(3, 64, 1)   # 3Dåæ ‡ â†’ 64ç»´ç‰¹å¾
        self.conv2 = nn.Conv1d(64, 128, 1) # 64ç»´ â†’ 128ç»´
        self.conv3 = nn.Conv1d(128, 1024, 1)# 128ç»´ â†’ 1024ç»´
        self.bn1 = nn.BatchNorm1d(64)
        self.bn2 = nn.BatchNorm1d(128)
        self.bn3 = nn.BatchNorm1d(1024)
        
        self.global_feat = global_feat  # æ˜¯å¦ä»…è¾“å‡ºå…¨å±€ç‰¹å¾ï¼ˆåˆ†ç±»ä»»åŠ¡ç”¨ï¼‰
        self.feature_transform = feature_transform  # æ˜¯å¦å¯ç”¨ç‰¹å¾å˜æ¢ï¼ˆå¯é€‰ï¼Œåˆ†å‰²ä»»åŠ¡å¸¸ç”¨ï¼‰
        if self.feature_transform:
            self.fstn = STNkd(k=64)  # ç‰¹å¾å˜æ¢ç½‘ç»œï¼ˆk=64ï¼Œå¯¹åº” conv1 è¾“å‡ºç»´åº¦ï¼‰

    def forward(self, x):
        # x è¾“å…¥å½¢çŠ¶ï¼š(B, 3, N)
        n_pts = x.size()[2]  # ç‚¹çš„æ•°é‡ Nï¼Œ2æŒ‡çš„æ˜¯ç¬¬ä¸‰ä¸ªç»´åº¦å³N
        
        # 1. åæ ‡å¯¹é½ï¼šç”¨ STN3d å˜æ¢åŸå§‹3Dåæ ‡
        trans = self.stn(x)  # å¾—åˆ° (B,3,3) å˜æ¢çŸ©é˜µ
        x = x.transpose(2, 1)  # (B,3,N) â†’ (B,N,3)ï¼ˆä¸ºäº†çŸ©é˜µä¹˜æ³•ï¼šç‚¹ Ã— å˜æ¢çŸ©é˜µï¼‰
        x = torch.bmm(x, trans)  # åº”ç”¨å˜æ¢ï¼š(B,N,3) Ã— (B,3,3) â†’ (B,N,3)
        x = x.transpose(2, 1)  # è¿˜åŸä¸º (B,3,N)
        
        # 2. å±€éƒ¨ç‰¹å¾æå–ï¼ˆå·ç§¯+æ¿€æ´»ï¼‰
        x = F.relu(self.bn1(self.conv1(x)))  # (B,3,N) â†’ (B,64,N)
        
        # 3. ç‰¹å¾å¯¹é½ï¼ˆå¯é€‰ï¼‰ï¼šç”¨ STNkd å˜æ¢64ç»´ç‰¹å¾
        if self.feature_transform:
            trans_feat = self.fstn(x)  # å¾—åˆ° (B,64,64) å˜æ¢çŸ©é˜µ
            x = x.transpose(2, 1)  # (B,64,N) â†’ (B,N,64)
            x = torch.bmm(x, trans_feat)  # åº”ç”¨ç‰¹å¾å˜æ¢ï¼š(B,N,64) Ã— (B,64,64) â†’ (B,N,64)
            x = x.transpose(2, 1)  # è¿˜åŸä¸º (B,64,N)
        else:
            trans_feat = None  # æ— ç‰¹å¾å˜æ¢æ—¶è¿”å› None
        
        pointfeat = x  # ä¿å­˜å±€éƒ¨ç‰¹å¾ï¼ˆåˆ†å‰²ä»»åŠ¡éœ€è¦ï¼‰
        
        # 4. å…¨å±€ç‰¹å¾æå–ï¼ˆå·ç§¯+æœ€å¤§æ± åŒ–ï¼‰
        x = F.relu(self.bn2(self.conv2(x)))  # (B,64,N) â†’ (B,128,N)
        x = self.bn3(self.conv3(x))          # (B,128,N) â†’ (B,1024,N)
        x = torch.max(x, 2, keepdim=True)[0] # å…¨å±€æœ€å¤§æ± åŒ–ï¼š(B,1024,N) â†’ (B,1024,1)
        x = x.view(-1, 1024)                 # å±•å¹³ä¸ºå…¨å±€ç‰¹å¾ï¼š(B,1024)
        
        # 5. æ ¹æ®ä»»åŠ¡è¿”å›ç‰¹å¾ï¼š
        if self.global_feat:
            # åˆ†ç±»ä»»åŠ¡ï¼šä»…è¿”å›å…¨å±€ç‰¹å¾ + å˜æ¢çŸ©é˜µ
            return x, trans, trans_feat
        else:
            # åˆ†å‰²ä»»åŠ¡ï¼šå…¨å±€ç‰¹å¾ + å±€éƒ¨ç‰¹å¾ï¼ˆå°†å…¨å±€ç‰¹å¾å¤åˆ¶ N æ¬¡ï¼Œä¸å±€éƒ¨ç‰¹å¾æ‹¼æ¥ï¼‰
            x = x.view(-1, 1024, 1).repeat(1, 1, n_pts)  # (B,1024,1) â†’ (B,1024,N)
            return torch.cat([x, pointfeat], 1), trans, trans_feat  # æ‹¼æ¥ï¼š1024+64=1088ç»´ â†’ (B,1088,N)


class PointNetCls(nn.Module):#åˆ†ç±»ä»»åŠ¡
    def __init__(self, k=2, feature_transform=False):
        super(PointNetCls, self).__init__()
        self.feature_transform = feature_transform
        self.feat = PointNetfeat(global_feat=True, feature_transform=feature_transform)
        self.fc1 = nn.Linear(1024, 512)
        self.fc2 = nn.Linear(512, 256)
        self.fc3 = nn.Linear(256, k)
        self.dropout = nn.Dropout(p=0.3)#è®¾ç½®ä¸¢å¼ƒæ¦‚ç‡ä¸º0.3ï¼Œç›®çš„æ˜¯é˜²æ­¢è¿‡æ‹Ÿåˆ
        self.bn1 = nn.BatchNorm1d(512)#å½’ä¸€åŒ–ï¼ŒåŠ å¿«è®­ç»ƒæ”¶æ•›é€Ÿåº¦å’Œæé«˜æ¨¡å‹ç¨³å®šæ€§
        self.bn2 = nn.BatchNorm1d(256)
        self.relu = nn.ReLU()

    def forward(self, x):
        x, trans, trans_feat = self.feat(x)
        x = F.relu(self.bn1(self.fc1(x)))
        x = F.relu(self.bn2(self.dropout(self.fc2(x))))
        x = self.fc3(x)
        return F.log_softmax(x, dim=1), trans, trans_feat


class PointNetDenseCls(nn.Module):#åˆ†å‰²ä»»åŠ¡
    def __init__(self, k = 2, feature_transform=False):
        super(PointNetDenseCls, self).__init__()
        self.k = k #kè¡¨ç¤ºåˆ†ç±»çš„ç±»åˆ«æ•°
        self.feature_transform=feature_transform
        self.feat = PointNetfeat(global_feat=False, feature_transform=feature_transform)
        self.conv1 = torch.nn.Conv1d(1088, 512, 1)
        self.conv2 = torch.nn.Conv1d(512, 256, 1)
        self.conv3 = torch.nn.Conv1d(256, 128, 1)
        self.conv4 = torch.nn.Conv1d(128, self.k, 1)
        self.bn1 = nn.BatchNorm1d(512)
        self.bn2 = nn.BatchNorm1d(256)
        self.bn3 = nn.BatchNorm1d(128)

    def forward(self, x):
        batchsize = x.size()[0]
        n_pts = x.size()[2]
        x, trans, trans_feat = self.feat(x)
        x = F.relu(self.bn1(self.conv1(x)))
        x = F.relu(self.bn2(self.conv2(x)))
        x = F.relu(self.bn3(self.conv3(x)))
        x = self.conv4(x)
        x = x.transpose(2,1).contiguous()
        x = F.log_softmax(x.view(-1,self.k), dim=-1)
        x = x.view(batchsize, n_pts, self.k)
        return x, trans, trans_feat

def feature_transform_regularizer(trans):
    d = trans.size()[1]
    batchsize = trans.size()[0]
    I = torch.eye(d)[None, :, :]
    if trans.is_cuda:
        I = I.cuda()
    loss = torch.mean(torch.norm(torch.bmm(trans, trans.transpose(2,1)) - I, dim=(1,2)))
    return loss

if __name__ == '__main__':
    sim_data = Variable(torch.rand(32,3,2500))
    trans = STN3d()
    out = trans(sim_data)
    print('stn', out.size())
    print('loss', feature_transform_regularizer(out))

    sim_data_64d = Variable(torch.rand(32, 64, 2500))
    trans = STNkd(k=64)
    out = trans(sim_data_64d)
    print('stn64d', out.size())
    print('loss', feature_transform_regularizer(out))

    pointfeat = PointNetfeat(global_feat=True)
    out, _, _ = pointfeat(sim_data)
    print('global feat', out.size())

    pointfeat = PointNetfeat(global_feat=False)
    out, _, _ = pointfeat(sim_data)
    print('point feat', out.size())

    cls = PointNetCls(k = 5)
    out, _, _ = cls(sim_data)
    print('class', out.size())

    seg = PointNetDenseCls(k = 3)
    out, _, _ = seg(sim_data)
    print('seg', out.size())
```

# é—®é¢˜
Pointnetæå–çš„å…¨å±€ç‰¹å¾èƒ½å¤Ÿå¾ˆå¥½åœ°å®Œæˆåˆ†ç±»ä»»åŠ¡ï¼Œç”±äºæ¨¡å‹åŸºæœ¬ä¸Šéƒ½æ˜¯å•ç‚¹é‡‡æ ·ï¼Œä»£ç åº•å±‚ç”¨çš„æ˜¯2Dconvï¼Œåªæœ‰maxpoolingæ•´åˆäº†æ•´ä½“ç‰¹å¾ï¼Œæ‰€ä»¥å±€éƒ¨ç‰¹å¾æå–èƒ½åŠ›è¾ƒå·®ï¼Œè¿™ä½¿å¾—å®ƒå¾ˆéš¾å¯¹å¤æ‚åœºæ™¯è¿›è¡Œåˆ†æã€‚


# Pointnet++
**ç‰¹ç‚¹** PointNet++çš„æ ¸å¿ƒæ˜¯æå‡ºäº†å¤šå±‚æ¬¡ç‰¹å¾æå–ç»“æ„ï¼Œæœ‰æ•ˆæå–å±€éƒ¨ç‰¹å¾æå–ï¼Œå’Œå…¨å±€ç‰¹å¾ã€‚
å¯ä»¥æŠŠåŸæœ¬çš„pointnetæ¨¡å‹ç±»æ¯”æˆ3dè§†è§‰å·¥ä½œçš„å·ç§¯å—ï¼Œè¿›è¡Œç‚¹äº‘ç‰¹å¾çš„å¤šå±‚æå–
## æ¨¡å‹æ¡†æ¶
![](assets/Pointnet/pointnet5.png)
# æ ¸å¿ƒæ€è·¯
å…ˆåœ¨è¾“å…¥ç‚¹é›†ä¸­é€‰æ‹©ä¸€äº›ç‚¹ä½œä¸ºä¸­å¿ƒç‚¹ï¼Œç„¶åå›´ç»•æ¯ä¸ªä¸­å¿ƒç‚¹é€‰æ‹©å‘¨å›´çš„ç‚¹ç»„æˆä¸€ä¸ªåŒºåŸŸï¼Œä¹‹åæ¯ä¸ªåŒºåŸŸä½œä¸ºPointNetçš„ä¸€ä¸ªè¾“å…¥æ ·æœ¬ï¼Œå¾—åˆ°ä¸€ç»„ç‰¹å¾ï¼Œè¿™ä¸ªç‰¹å¾å°±æ˜¯è¿™ä¸ªåŒºåŸŸçš„ç‰¹å¾ã€‚
ä¹‹åä¸­å¿ƒç‚¹ä¸å˜ï¼Œæ‰©å¤§åŒºåŸŸï¼ŒæŠŠä¸Šä¸€æ­¥å¾—åˆ°çš„é‚£äº›ç‰¹å¾ä½œä¸ºè¾“å…¥é€å…¥PointNetï¼Œä»¥æ­¤ç±»æ¨ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ä¸æ–­çš„æå–å±€éƒ¨ç‰¹å¾ï¼Œç„¶åæ‰©å¤§å±€éƒ¨èŒƒå›´ï¼Œæœ€åå¾—åˆ°ä¸€ç»„å…¨å±€çš„ç‰¹å¾ï¼Œç„¶åè¿›è¡Œåˆ†ç±»ã€‚
![](assets/Pointnet/pointnet6.jpeg)
- **åˆ†ç±»ç½‘ç»œ**ï¼šä¸€ç³»åˆ— **SA æ¨¡å—** $\rightarrow$ æå–æœ€ç»ˆçš„**å…¨å±€ç‰¹å¾** $\rightarrow$ æ¥å…¥**å…¨è¿æ¥å±‚ (FC Layer)** $\rightarrow$ è¾“å‡ºåˆ†ç±»ç»“æœã€‚
    
- **åˆ†å‰²ç½‘ç»œ**ï¼šä¸€ç³»åˆ— **SA æ¨¡å—** (ä¸‹é‡‡æ ·è·¯å¾„) $\rightarrow$ ä¸€ç³»åˆ— **FP æ¨¡å—** (ä¸Šé‡‡æ ·è·¯å¾„ï¼ŒåŒ…å«è·³è·ƒè¿æ¥) $\rightarrow$ è¾“å‡º**é€ç‚¹ç‰¹å¾** $\rightarrow$ æ¥å…¥**å…¨è¿æ¥å±‚ (FC Layer)** $\rightarrow$ è¾“å‡ºæ¯ä¸ªç‚¹çš„åˆ†å‰²æ ‡ç­¾ã€‚
## Set Abstraction (SA) å±‚
SA å±‚æ¥æ”¶ä¸€ä¸ªç‚¹é›†ï¼Œå¹¶è¾“å‡ºä¸€ä¸ªåŒ…å«æ›´å°‘ç‚¹æ•°ä½†å…·æœ‰æ›´ä¸°å¯Œç‰¹å¾çš„æŠ½è±¡ç‚¹é›†ï¼Œä»è€Œé€æ­¥æ„å»ºèµ·ç‚¹äº‘çš„å±‚æ¬¡ç»“æ„ã€‚

å®ƒçš„æ“ä½œå¯ä»¥åˆ†è§£ä¸ºä¸‰ä¸ªæ ¸å¿ƒæ­¥éª¤ï¼š

1. **é‡‡æ · (Sampling)** ğŸ“ï¼šä»è¾“å…¥ç‚¹äº‘ä¸­é€‰æ‹©ä¸€ç»„ä¸­å¿ƒç‚¹ï¼Œè¿™äº›ç‚¹å°†ä½œä¸ºå±€éƒ¨åŒºåŸŸçš„ä»£è¡¨ã€‚
    
2. **åˆ†ç»„ (Grouping)** ğŸ“¦ï¼šå¯¹äºæ¯ä¸ªä¸­å¿ƒç‚¹ï¼Œæ‰¾åˆ°å®ƒå‘¨å›´çš„é‚»è¿‘ç‚¹ï¼Œå½¢æˆä¸€ä¸ªå±€éƒ¨åŒºåŸŸã€‚
    
3. **å±€éƒ¨ç‰¹å¾æå– (Local PointNet)** âš™ï¸ï¼šå¯¹æ¯ä¸ªå±€éƒ¨åŒºåŸŸåº”ç”¨ä¸€ä¸ªå°å‹ PointNetï¼Œå°†ä¸€ç»„ç‚¹ï¼ˆä¸€ä¸ªåŒºåŸŸï¼‰æŠ½è±¡ä¸ºä¸€ä¸ªå•ä¸€çš„ç‰¹å¾å‘é‡ã€‚
    

### **é‡‡æ ·**
PointNet++ é‡‡ç”¨**æœ€è¿œç‚¹é‡‡æ · (Farthest Point Sampling, FPS)** çš„æ–¹æ³•æ¥ç¡®å®šå±€éƒ¨åŒºåŸŸçš„ä¸­å¿ƒç‚¹ã€‚
1. **æœ€å¤§åŒ–æœ€å°è·ç¦»**ï¼šFPS çš„æ ¸å¿ƒåŸåˆ™æ˜¯ï¼šé€‰æ‹©ä¸‹ä¸€ä¸ªä¸­å¿ƒç‚¹çš„æ ‡å‡†æ˜¯ï¼Œåœ¨æ‰€æœ‰å‰©ä½™ç‚¹ä¸­ï¼Œé€‰æ‹©é‚£ä¸ª**ç¦»æ‰€æœ‰å·²é€‰ä¸­å¿ƒç‚¹é›†åˆæœ€è¿œ**çš„ç‚¹ã€‚
    
2. **ä¿è¯è¦†ç›–ç‡**ï¼šè¿™ä¸ªæœºåˆ¶ç¡®ä¿äº†æ–°é€‰æ‹©çš„ç‚¹ä¸ä¼šæ‰å †èšé›†åœ¨å·²é€‰ç‚¹é™„è¿‘ã€‚ç»“æœå°±æ˜¯ï¼Œä¸­å¿ƒç‚¹èƒ½å¤Ÿ**å‡åŒ€ã€åˆ†æ•£**åœ°åˆ†å¸ƒåœ¨æ•´ä¸ªç‚¹äº‘ä¸Šï¼Œæœ€å¤§é™åº¦åœ°è¦†ç›–ç‚¹äº‘ã€‚
    

ğŸŒŸ **ä¼˜åŠ¿**ï¼šè¿™ç§å‡åŒ€æ€§ä¿è¯äº†æˆ‘ä»¬é€‰å‡ºçš„å±€éƒ¨åŒºåŸŸä¸­å¿ƒç‚¹å…·æœ‰å¾ˆå¥½çš„**ä»£è¡¨æ€§**ã€‚è¿™æ„å‘³ç€ç‚¹äº‘ä¸­æ‰€æœ‰é‡è¦çš„å±€éƒ¨ç»“æ„éƒ½æœ‰æœºä¼šè¢«â€œçœ‹åˆ°â€å¹¶æå–ç‰¹å¾ï¼Œé¿å…äº†ç”±äºé‡‡æ ·ä¸ä½³è€Œå¯¼è‡´çš„ç‰¹å¾åå€šã€‚
### **åˆ†ç»„**
ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†å‡åŒ€åˆ†å¸ƒçš„**ä¸­å¿ƒç‚¹** $\text{C}$ï¼Œå°±å¯ä»¥è¿›å…¥ Set Abstraction (SA) å±‚çš„ç¬¬äºŒæ­¥ï¼š**åˆ†ç»„ (Grouping)** ğŸ“¦ã€‚

è¿™ä¸€æ­¥çš„ç›®æ ‡æ˜¯ï¼šå¯¹äºæ¯ä¸€ä¸ªä¸­å¿ƒç‚¹ $c$ï¼Œæ‰¾å‡ºå®ƒå‘¨å›´çš„é‚»è¿‘ç‚¹ $N_c$ï¼Œä»è€Œå®šä¹‰ä¸€ä¸ªéœ€è¦è¿›è¡Œå±€éƒ¨ç‰¹å¾æå–çš„åŒºåŸŸã€‚

PointNet++ ä¸»è¦é‡‡ç”¨ä¸¤ç§æ–¹æ³•æ¥å®šä¹‰è¿™ä¸ªå±€éƒ¨é‚»åŸŸï¼š

1. **çƒå½¢æŸ¥è¯¢ (Ball Query)** âš½ï¼šä»¥ä¸­å¿ƒç‚¹ $c$ ä¸ºçƒå¿ƒï¼Œä»¥ä¸€ä¸ªå›ºå®šçš„åŠå¾„ $r$ åˆ’å®šä¸€ä¸ªçƒå½¢åŒºåŸŸï¼ŒåŒºåŸŸå†…çš„æ‰€æœ‰ç‚¹éƒ½è¢«è§†ä¸ºé‚»åŸŸç‚¹ $N_c$ã€‚
    
2. **K-è¿‘é‚» (k-Nearest Neighbor, k-NN)** ğŸ§®ï¼šç›´æ¥æ‰¾å‡ºç¦»ä¸­å¿ƒç‚¹ $c$ **æœ€è¿‘çš„** $K$ ä¸ªç‚¹ä½œä¸ºé‚»åŸŸç‚¹ $N_c$ã€‚
BQ é€šè¿‡å›ºå®šåŠå¾„ $r$ï¼Œç¡®ä¿äº†åªæœ‰åœ¨ç©ºé—´ä¸Šè¶³å¤Ÿæ¥è¿‘ä¸­å¿ƒç‚¹ $c$ çš„ç‚¹æ‰ä¼šè¢«çº³å…¥é‚»åŸŸï¼Œè¿™æ­£æ˜¯**å±€éƒ¨æ€§**çš„å®šä¹‰ã€‚ä½†æ›´å…³é”®çš„æ˜¯ï¼Œåœ¨å¤„ç†**å¯†åº¦ä¸å‡åŒ€**çš„é—®é¢˜ä¸Šï¼ŒBQ çš„è¡¨ç°ä¼˜äº k-NNï¼ŒåŸå› åœ¨äºå®ƒæ”¶é›†çš„ç‚¹çš„**æ•°é‡**æ˜¯å¯å˜çš„ï¼š

- **åœ¨å¯†åº¦é«˜çš„åŒºåŸŸ**ï¼šåŠå¾„ $r$ å†…çš„ç‚¹ä¼š**å¾ˆå¤š**ã€‚BQ æ”¶é›†åˆ°å¤§é‡çš„ç‚¹ï¼Œèƒ½æå–å‡ºæ›´ç»†è‡´çš„å±€éƒ¨ç‰¹å¾ã€‚
    
- **åœ¨å¯†åº¦ä½çš„åŒºåŸŸ**ï¼šåŠå¾„ $r$ å†…çš„ç‚¹ä¼š**å¾ˆå°‘**ã€‚BQ ä»ç„¶åªæ”¶é›†è¿™äº›ç‚¹ï¼Œä»è€Œé¿å…äº† k-NN ä¸ºäº†å‡‘å¤Ÿ $K$ ä¸ªç‚¹è€Œ**ä¸å¾—ä¸æ‰©å¤§é‚»åŸŸèŒƒå›´**ï¼Œå°†è·ç¦»å¾ˆè¿œã€ä¸ç›¸å…³çš„ç‚¹çº³å…¥åˆ†ç»„ï¼Œç ´åå±€éƒ¨æ€§çš„é—®é¢˜ã€‚
    
å› æ­¤ï¼Œ**Ball Query** æ˜¯ PointNet++ å®ç°å¯¹**éå‡åŒ€é‡‡æ ·é²æ£’æ€§**çš„å…³é”®ä¹‹ä¸€ã€‚

### å±€éƒ¨ç‰¹å¾æå– (Local PointNet)
å¯¹äºæ¯ä¸ªå±€éƒ¨é‚»åŸŸ $N_c$ï¼Œæˆ‘ä»¬ç°åœ¨éœ€è¦å°†å…¶è½¬æ¢æˆä¸€ä¸ª**å•ä¸€çš„ã€å…·æœ‰ä»£è¡¨æ€§çš„ç‰¹å¾å‘é‡** $f_c$ã€‚PointNet++ åœ¨è¿™é‡Œä½¿ç”¨äº†æ ‡å‡†çš„ PointNet ç»“æ„ã€‚

### **åˆ†å±‚å¯†åº¦èšåˆ (Hierarchical Density Aggregation, HDA)**
å›åˆ° PointNet++ çš„æ ¸å¿ƒæŒ‘æˆ˜ï¼š**é²æ£’æ€§**ã€‚å°½ç®¡æˆ‘ä»¬ç”¨äº† Ball Query æ¥é€‚åº”ä¸åŒå¯†åº¦åŒºåŸŸï¼Œä½†ä¸åŒå¯†åº¦çš„åŒºåŸŸç”Ÿæˆçš„ç‰¹å¾å‘é‡ï¼Œå…¶**å¯ä¿¡åº¦**å’Œ**ä¿¡æ¯é‡**æ˜¯ä¸åŒçš„ã€‚
PointNet++ ä¸ºæ­¤æå‡ºäº† **åˆ†å±‚å¯†åº¦èšåˆ (Hierarchical Density Aggregation, HDA)** ç­–ç•¥æ¥è§£å†³å¯†åº¦å·®å¼‚çš„é—®é¢˜ã€‚


HDA çš„å·¥ä½œæœºåˆ¶ï¼Œç‰¹åˆ«æ˜¯ç»“åˆ**å¤šå°ºåº¦åˆ†ç»„ (MSG)** æ—¶ï¼Œå…·ä½“æ˜¯è¿™æ ·çš„ï¼š

- **å¤šå°ºåº¦æå–**ï¼šMSG é¦–å…ˆåœ¨å¤šä¸ªä¸åŒçš„åŠå¾„ $r_1, r_2, r_3, \dots$ ä¸‹æå–ç‰¹å¾ã€‚
    
- **å¯†åº¦æ„ŸçŸ¥åŠ æƒ**ï¼šç„¶åï¼ŒHDA å­¦ä¹ ä¸€ä¸ªè‡ªé€‚åº”çš„æƒé‡å‡½æ•°ï¼Œæ¥èåˆè¿™äº›ä¸åŒå°ºåº¦çš„ç‰¹å¾ã€‚
    

**æ ¸å¿ƒé€»è¾‘**ï¼šåœ¨**ç¨€ç–**çš„åŒºåŸŸï¼Œè¾ƒå°çš„åŠå¾„ï¼ˆ$r_1$ï¼‰å¯èƒ½åªæ”¶é›†åˆ°å¾ˆå°‘çš„ç‚¹ï¼Œç”šè‡³æ²¡æœ‰ç‚¹ï¼Œå› æ­¤è¿™äº›å°å°ºåº¦ç‰¹å¾çš„**ä¿¡æ¯é‡ä½ï¼Œä¸å¯ä¿¡åº¦é«˜**ã€‚HDA ä¼šé™ä½è¿™äº›ä¸å¯é çš„å°å°ºåº¦ç‰¹å¾çš„æƒé‡ï¼Œå¹¶æ›´å¤šåœ°ä¾èµ–äºåŒ…å«æ›´å¤šé‚»åŸŸä¿¡æ¯çš„å¤§å°ºåº¦ç‰¹å¾ï¼Œæˆ–è€…ç›´æ¥é™ä½æ•´ä¸ªåŒºåŸŸç‰¹å¾çš„æƒé‡ï¼Œä»¥ç¡®ä¿ç‰¹å¾çš„å¯é æ€§ã€‚
## åˆ†å‰²
åˆ†ç±»ä»»åŠ¡åªéœ€è¦ä¸€ä¸ªæœ€ç»ˆçš„**å…¨å±€ç‰¹å¾**ï¼›è€Œåˆ†å‰²ä»»åŠ¡éœ€è¦å°†ç‰¹å¾**è¿˜åŸ**åˆ°åŸå§‹ç‚¹äº‘çš„å¯†åº¦ï¼Œä¸ºæ¯ä¸ªç‚¹æä¾›ä¸€ä¸ª**é€ç‚¹ç‰¹å¾**è¿›è¡Œé¢„æµ‹ã€‚
PointNet++ å¼•å…¥çš„ **ç‰¹å¾ä¼ æ’­ (Feature Propagation, FP) æ¨¡å—**ã€‚
FP æ¨¡å—ä½äºç½‘ç»œçš„**ä¸Šé‡‡æ ·**é˜¶æ®µï¼Œå®ƒçš„å·¥ä½œæ˜¯å°†æŠ½è±¡çš„ç‰¹å¾é€å±‚æ¢å¤åˆ°åŸå§‹ç‚¹äº‘çš„åˆ†è¾¨ç‡ã€‚æ¯ä¸ª FP æ¨¡å—ä¸»è¦åŒ…å«ä¸¤ä¸ªå…³é”®æ­¥éª¤ï¼š

1. **æ’å€¼ (Interpolation)**ï¼šå®ƒå°†è¾ƒç¨€ç–ç‚¹é›†ï¼ˆSA æ¨¡å—çš„è¾“å‡ºï¼‰ä¸Šçš„ç‰¹å¾ï¼Œé€šè¿‡**é€†è·ç¦»åŠ æƒ (Inverse Distance Weighted, IDW)** æ’å€¼çš„æ–¹æ³•ï¼Œä¼ é€’ç»™è¾ƒå¯†é›†çš„ç‚¹é›†ï¼ˆSA æ¨¡å—çš„è¾“å…¥ï¼‰ã€‚ç®€å•æ¥è¯´ï¼Œç¦»å¾—è¿‘çš„ç‚¹ä¼šè·å¾—æ›´é«˜çš„æƒé‡ã€‚
    
2. **ç‰¹å¾èåˆï¼ˆFeature Fusionï¼‰**ï¼šæ’å€¼å¾—åˆ°çš„ç‰¹å¾ä¼šä¸ SA æ¨¡å—ä¸­**è·³è·ƒè¿æ¥ (Skip Connection)** ğŸ”— ä¼ æ¥çš„åŸå§‹é«˜åˆ†è¾¨ç‡ç‰¹å¾ï¼ˆ**æœªä¸‹é‡‡æ ·çš„ç‰¹å¾**ï¼‰è¿›è¡Œæ‹¼æ¥ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†å¼¥è¡¥ä¸‹é‡‡æ ·è¿‡ç¨‹ä¸­ä¸¢å¤±çš„ç»†èŠ‚ä¿¡æ¯ã€‚æ‹¼æ¥åçš„ç‰¹å¾å†é€šè¿‡ä¸€ä¸ªå…±äº« MLP è¿›è¡Œèåˆå’Œæç‚¼ã€‚

| **FP æ¨¡å— ç»„ä»¶**  | **æ¥æºï¼ˆè¾“å…¥ï¼‰**                        | **ç‰¹å¾/ç‚¹äº‘æ•°é‡**         | **ä½œç”¨**        |
| ------------- | --------------------------------- | ------------------- | ------------- |
| **è¾“å…¥ 1ï¼šæŠ½è±¡ç‰¹å¾** | **ä¸Šä¸€å±‚ FP æ¨¡å—**ï¼ˆæˆ–æœ€åä¸€å±‚ SAï¼‰           | ç‚¹æ•°è¾ƒå°‘ ($N_{coarse}$) | åŒ…å«å…¨å±€å’ŒæŠ½è±¡ä¿¡æ¯     |
| **è¾“å…¥ 2ï¼šç²¾ç»†ç‰¹å¾** | **å¯¹åº” SA æ¨¡å—çš„è¾“å…¥** (Skip Connection) | ç‚¹æ•°è¾ƒå¤š ($N_{fine}$)   | åŒ…å«é«˜åˆ†è¾¨ç‡çš„å±€éƒ¨å‡ ä½•ç»†èŠ‚ |
| **è¾“å‡º**        | **$N_{fine}$ ç‚¹çš„æ›´æ–°ç‰¹å¾**             | ç‚¹æ•°è¾ƒå¤š ($N_{fine}$)   | æ¢å¤åˆ°æ›´é«˜åˆ†è¾¨ç‡çš„ç‰¹å¾   |




